<?php

namespace Semantics\RatingBundle\Repository;

use Doctrine\ORM\EntityRepository;
use Semantics\RatingBundle\Interfaces\SemanticEntityHolder;
use Symfony\Bridge\Doctrine\RegistryInterface;

/**
 * CorpusRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class WordRepository extends EntityRepository
{
    /**
     *
     *
     * @param RegistryInterface $orm
     * @param SemanticEntityHolder $entity
     * @return SemanticEntityHolder
     */
    public function save(RegistryInterface $orm, SemanticEntityHolder $entity)
    {
        $matches        = $this->findBy(['word' => $entity->getWord()]);
        $existingEntity = array_shift($matches);
        if (!$existingEntity instanceof SemanticEntityHolder) {
            $orm->getManager()->persist($entity);
            $orm->getManager()->flush();
            return $entity;
        }
        $existingEntity->copy($entity);
        $orm->getManager()->flush();
        return $existingEntity;
    }
}
